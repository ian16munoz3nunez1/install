FROM debian:latest
SHELL ["/bin/bash", "-c"]
ENV USER=user_name
ENV PASSWORD=1234

# primary configuration
RUN apt update -y && apt upgrade -y && apt dist-upgrade -y && apt autoremove -y
# RUN rm -rf /var/lib/apt/lists/*
RUN ln -sfn /usr/share/zoneinfo/America/Mexico_City /etc/localtime

# Port configuration
EXPOSE 22

# services
RUN apt install sudo -y

# User settings
RUN useradd -rm -d /home/$USER -s /bin/bash -g root -G sudo $USER
RUN echo "$USER:$PASSWORD" | chpasswd
RUN groupadd $USER -U $USER
RUN chown $USER:$USER -R /home/$USER
RUN chmod 700 -R /home/$USER
COPY --chown=$USER:$USER .ssh/id_rsa.pub /home/$USER/.ssh/authorized_keys

USER $USER
WORKDIR /home/$USER

RUN mkdir /home/$USER/Desktop /home/$USER/Downloads /home/$USER/Music /home/$USER/Pictures /home/$USER/Videos
RUN chown $USER:$USER -R /home/$USER/Desktop /home/$USER/Downloads /home/$USER/Music /home/$USER/Pictures /home/$USER/Videos
RUN chmod 700 -R /home/$USER/Desktop /home/$USER/Downloads /home/$USER/Music /home/$USER/Pictures /home/$USER/Videos

# packages
RUN echo "$PASSWORD" | sudo -S apt install ssh -y
RUN echo "$PASSWORD" | sudo -S apt install iputils-ping -y
RUN echo "$PASSWORD" | sudo -S apt install net-tools -y
RUN echo "$PASSWORD" | sudo -S apt install iproute2 -y
RUN echo "$PASSWORD" | sudo -S apt install nano -y
RUN echo "$PASSWORD" | sudo -S apt install vim -y
RUN echo "$PASSWORD" | sudo -S apt install vim-gtk3 -y
RUN echo "$PASSWORD" | sudo -S apt install git -y
RUN echo "$PASSWORD" | sudo -S apt install bat -y
RUN echo "$PASSWORD" | sudo -S apt install tmux -y
RUN echo "$PASSWORD" | sudo -S apt install caca-utils -y
RUN echo "$PASSWORD" | sudo -S apt install curl -y
RUN echo "$PASSWORD" | sudo -S apt install wget -y
RUN echo "$PASSWORD" | sudo -S apt install tree -y
RUN echo "$PASSWORD" | sudo -S apt install ranger -y
RUN echo "$PASSWORD" | sudo -S apt install python3 -y
RUN echo "$PASSWORD" | sudo -S apt install python3-flask -y

COPY --chown=$USER:$USER .bin/ /home/$USER/.bin/
RUN echo -e "\n\nexport PATH=\"\$PATH\":/home/$USER/.bin\"\"" >> /home/$USER/.bashrc

# setup
ENTRYPOINT echo "$PASSWORD" | sudo -S service ssh start && tail -f /dev/null

