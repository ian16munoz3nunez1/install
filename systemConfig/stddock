FROM ubuntu:latest
SHELL ["/bin/bash", "-c"]
ENV USER=user_name
ENV PASSWORD=1234

# primary configuration
RUN apt-get update -y && apt-get upgrade -y && apt-get dist-upgrade -y && apt-get autoremove -y
# RUN rm -rf /var/lib/apt/lists/*
RUN ln -sfn /usr/share/zoneinfo/America/Mexico_City /etc/localtime

# Port configuration
EXPOSE 22

# services
RUN apt-get install sudo -y

# User settings
RUN useradd -rm -d /home/$USER -s /bin/bash -g root -G sudo $USER
RUN echo "$USER:$PASSWORD" | chpasswd
RUN groupadd $USER -U $USER
RUN chown $USER:$USER -R /home/$USER
RUN chmod 700 -R /home/$USER
COPY --chown=$USER:$USER .ssh/id_rsa.pub /home/$USER/.ssh/authorized_keys

USER $USER
WORKDIR /home/$USER

RUN mkdir /home/$USER/Desktop /home/$USER/Downloads /home/$USER/Music /home/$USER/Pictures /home/$USER/Videos
RUN chown $USER:$USER -R /home/$USER/Desktop /home/$USER/Downloads /home/$USER/Music /home/$USER/Pictures /home/$USER/Videos
RUN chmod 700 -R /home/$USER/Desktop /home/$USER/Downloads /home/$USER/Music /home/$USER/Pictures /home/$USER/Videos

# packages
RUN echo "$PASSWORD" | sudo -S apt-get install ssh -y
RUN echo "$PASSWORD" | sudo -S apt-get install iputils-ping -y
RUN echo "$PASSWORD" | sudo -S apt-get install net-tools -y
RUN echo "$PASSWORD" | sudo -S apt-get install iproute2 -y
RUN echo "$PASSWORD" | sudo -S apt-get install nano -y
RUN echo "$PASSWORD" | sudo -S apt-get install vim -y
RUN echo "$PASSWORD" | sudo -S apt-get install vim-gtk3 -y
RUN echo "$PASSWORD" | sudo -S apt-get install neovim -y
RUN echo "$PASSWORD" | sudo -S apt-get install git -y
RUN echo "$PASSWORD" | sudo -S apt-get install bat -y
RUN echo "$PASSWORD" | sudo -S apt-get install tmux -y
RUN echo "$PASSWORD" | sudo -S apt-get install caca-utils -y
RUN echo "$PASSWORD" | sudo -S apt-get install curl -y
RUN echo "$PASSWORD" | sudo -S apt-get install wget -y
RUN echo "$PASSWORD" | sudo -S apt-get install tree -y
RUN echo "$PASSWORD" | sudo -S apt-get install ranger -y
RUN echo "$PASSWORD" | sudo -S apt-get install gcc g++ -y
RUN echo "$PASSWORD" | sudo -S apt-get install python3 -y
RUN echo "$PASSWORD" | sudo -S apt-get install python3-flask -y
RUN echo "$PASSWORD" | sudo -S apt-get install default-jdk default-jre  -y
RUN echo "$PASSWORD" | sudo -S apt-get install golang -y
RUN echo "$PASSWORD" | sudo -S apt-get install ruby ruby-dev -y

COPY --chown=$USER:$USER .vimrc /home/$USER/.vimrc
COPY --chown=$USER:$USER .vim/ /home/$USER/.vim/

COPY --chown=$USER:$USER .bin/ /home/$USER/.bin/
RUN echo -e "\n\nexport PATH=\"\$PATH\":/home/$USER/.bin\"\"" >> /home/$USER/.bashrc

# setup
ENTRYPOINT echo "$PASSWORD" | sudo -S service ssh start && tail -f /dev/null
