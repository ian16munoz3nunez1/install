#!/bin/bash

if [[ $USER == git ]]; then
    . /home/git/git-shell-commands/gutils.sh

    file=$1
    user=$2
    repo=$3

    line1=$(get_line2delete $file $user $repo)
    line2=$(get_line2delete $file $user $(get_cmp_repo $repo))

    echo -e "Do you want to delete the repository \"$repo\"?... [Y/n]"
    read -n 1 ans
    if [[ $ans == "Y" || $ans == "y" ]]; then
        if [ $line1 -gt $line2 ]; then
            sed -i "${line1}d" "$file"
            sed -i "${line2}d" "$file"
        else
            sed -i "${line2}d" "$file"
            sed -i "${line1}d" "$file"
        fi
        echo "Repository \"$repo\" deleted from \"$file\""

    else
        echo -e "\nOperation cancelled"
    fi

else
    if [ $# -ne 3 ]; then
        echo "More or less arguments used"
        echo "User: $0 <host> <username> <repo>"
        exit 1
    fi

    host=$1
    user=$2
    repo=$3
    ssh git@$host "delu2r $user $repo"
fi
